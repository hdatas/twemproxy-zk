MAINTAINERCLEANFILES = Makefile.in

AM_CPPFLAGS = -g
if !OS_SOLARIS
AM_CPPFLAGS += -D_GNU_SOURCE
endif
AM_CPPFLAGS += -I $(top_srcdir)/src/hashkit
AM_CPPFLAGS += -I $(top_srcdir)/src/proto
AM_CPPFLAGS += -I $(top_srcdir)/src/event
AM_CPPFLAGS += -I $(top_srcdir)/src/parson
AM_CPPFLAGS += -I $(top_srcdir)/src/hdr_histogram
AM_CPPFLAGS += -I $(top_srcdir)/contrib/yaml-0.1.4/include

AM_CFLAGS = -std=c99
# about -fno-strict-aliasing: https://github.com/twitter/twemproxy/issues/276
AM_CFLAGS += -fno-strict-aliasing
AM_CFLAGS += -Wall -Wshadow
AM_CFLAGS += -Wpointer-arith
AM_CFLAGS += -Winline
AM_CFLAGS += -Wunused-function -Wunused-variable -Wunused-value
AM_CFLAGS += -Wno-unused-parameter -Wno-unused-value
AM_CFLAGS += -Wconversion -Wsign-compare
AM_CFLAGS += -Wstrict-prototypes -Wmissing-prototypes -Wredundant-decls -Wmissing-declarations
AM_CFLAGS += -I/usr/local/include/zookeeper
AM_MAKEFLAGS = "CFLAGS = -I../../src/hdr_histogram"

AM_LDFLAGS =
AM_LDFLAGS += -lm -lpthread -lz -rdynamic
if OS_SOLARIS
AM_LDFLAGS += -lnsl -lsocket
endif
if OS_FREEBSD
AM_LDFLAGS += -lexecinfo
endif
AM_LDFLAGS += -L/usr/local/lib -lzookeeper_mt

SUBDIRS = hashkit proto event parson hdr_histogram

lib_LTLIBRARIES = libnutcracker.la
libnutcracker_la_SOURCES =			\
	nc.c nc.h		\
	nc_core.c nc_core.h		\
	nc_connection.c nc_connection.h	\
	nc_client.c nc_client.h		\
	nc_server.c nc_server.h		\
	nc_proxy.c nc_proxy.h		\
	nc_message.c nc_message.h	\
	nc_request.c			\
	nc_response.c			\
	nc_mbuf.c nc_mbuf.h		\
	nc_conf.c nc_conf.h		\
	nc_stats.c nc_stats.h		\
	nc_signal.c nc_signal.h		\
	nc_rbtree.c nc_rbtree.h		\
	nc_log.c nc_log.h		\
	nc_string.c nc_string.h		\
	nc_array.c nc_array.h		\
	nc_util.c nc_util.h		\
	nc_queue.h			\
  zkutil.c zkutil.h

libnutcracker_la_LIBADD = \
                          $(top_builddir)/src/event/libevent.la \
                          $(top_builddir)/src/hashkit/libhashkit.la \
                          $(top_builddir)/src/proto/libproto.la \
                          $(top_builddir)/src/parson/libparson.la \
                          $(top_builddir)/src/hdr_histogram/libhdrhistogram.la \
                          $(top_builddir)/contrib/yaml-0.1.4/src/libyaml.la

sbin_PROGRAMS = nutcracker
nutcracker_SOURCES = main.c
nutcracker_LDADD = libnutcracker.la
